<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Inside Ali's Conversation Engine | Ali MVP</title>
<style>
@font-face { font-family: "Moret"; src: url("../fonts/moret-semibold-webfont.woff2") format("woff2"); font-weight: 600; font-display: swap; }
@font-face { font-family: "Inter"; src: url("../fonts/inter-latin-400-normal.woff2") format("woff2"); font-weight: 400; font-display: swap; }
@font-face { font-family: "Inter"; src: url("../fonts/inter-latin-600-normal.woff2") format("woff2"); font-weight: 600; font-display: swap; }

* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --text-primary: #1a1917; --text-body: #33312d; --text-secondary: #6f6a63; --text-muted: #9c958c;
  --border: #d1cbc2; --border-hard: #3f3c38; --border-dashed: #b5afa6;
  --bg-page: #f5f3f0; --bg-card: #ffffff; --bg-muted: #eae6e0; --bg-surface: #faf9f7;
  --font-sans: "Inter", system-ui, -apple-system, sans-serif;
  --font-serif: "Moret", Georgia, serif;
  --font-mono: "SF Mono", "Fira Code", "Cascadia Code", "JetBrains Mono", monospace;
  --asf-gradient: linear-gradient(73.1deg, rgb(95,175,138) 0%, rgb(127,191,174) 12.39%, rgb(158,198,217) 39.57%, rgb(168,191,217) 58.16%, rgb(159,164,211) 79.32%, rgb(138,132,198) 99.15%);
  --blue: #2563eb; --blue-bg: #dbeafe; --blue-hl: rgba(37,99,235,0.12);
  --pink: #be185d; --pink-bg: #fce7f3; --pink-hl: rgba(190,24,93,0.10);
  --green: #059669; --green-bg: #d1fae5; --green-hl: rgba(5,150,105,0.10);
  --amber: #d97706; --amber-bg: #fef3c7; --amber-hl: rgba(217,119,6,0.10);
  --book-gty: #22a06b; --book-nsfd: #7c7fc4; --book-3dn: #4a8ec2; --book-asf: #7b5ea7;
  --book-gty-hl: rgba(34,160,107,0.13); --book-nsfd-hl: rgba(124,127,196,0.13);
  --book-3dn-hl: rgba(74,142,194,0.13); --book-asf-hl: rgba(123,94,167,0.15);
}
html { scroll-behavior: smooth; }
body { font-family: var(--font-sans); background: var(--bg-page); color: var(--text-primary); line-height: 1.6; -webkit-font-smoothing: antialiased; }

/* ── Hero ── */
.hero { background: var(--asf-gradient); padding: 52px 40px 44px; text-align: center; position: relative; }
.hero::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 4px; background: var(--bg-page); }
.hero h1 { font-family: var(--font-serif); font-weight: 600; font-size: 2.2rem; color: white; margin-bottom: 6px; letter-spacing: -0.02em; }
.hero .subtitle { font-size: 0.88rem; color: rgba(255,255,255,0.9); max-width: 540px; margin: 0 auto; line-height: 1.6; }
.hero-stats { display: flex; justify-content: center; gap: 40px; margin-top: 28px; }
.hero-stat { text-align: center; }
.hero-stat .num { font-family: var(--font-mono); font-size: 1.8rem; font-weight: 700; color: white; letter-spacing: -0.03em; }
.hero-stat .label { font-family: var(--font-mono); font-size: 0.62rem; color: rgba(255,255,255,0.7); text-transform: uppercase; letter-spacing: 1.5px; margin-top: 2px; }

/* ── Gradient Divider ── */
.grad-divider { height: 2px; background: var(--asf-gradient); opacity: 0.5; }

/* ── Pill Nav ── */
.pill-nav { display: flex; gap: 4px; justify-content: center; flex-wrap: wrap; padding: 16px 20px 12px; position: sticky; top: 0; z-index: 100; background: var(--bg-page); border-bottom: 2px solid var(--border-hard); }
.pill-btn { font-family: var(--font-mono); font-size: 0.68rem; font-weight: 600; padding: 6px 14px; border: 2px solid transparent; border-radius: 4px; background: transparent; color: var(--text-muted); cursor: pointer; transition: all 0.15s; text-transform: uppercase; letter-spacing: 0.8px; }
.pill-btn:hover { color: var(--text-primary); border-color: var(--border); }
.pill-btn.active { color: var(--text-primary); border-color: var(--border-hard); background: var(--bg-card); }

/* ── Sections ── */
.section { padding: 44px 40px 52px; max-width: 880px; margin: 0 auto; }
.section-label { font-family: var(--font-mono); font-size: 0.62rem; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); margin-bottom: 6px; }
.section-title { font-family: var(--font-serif); font-weight: 600; font-size: 1.6rem; margin-bottom: 4px; letter-spacing: -0.01em; }
.section-desc { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 32px; line-height: 1.6; }

/* ── Legend Bar ── */
.legend { display: flex; gap: 16px; flex-wrap: wrap; padding: 14px 20px; background: var(--bg-card); border: 2px solid var(--border); border-radius: 6px; margin-bottom: 24px; }
.legend-title { font-family: var(--font-mono); font-size: 0.62rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); width: 100%; margin-bottom: 2px; }
.legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.78rem; font-weight: 600; }
.legend-dot { width: 10px; height: 10px; border-radius: 2px; flex-shrink: 0; }
.legend-count { font-family: var(--font-mono); font-size: 0.72rem; color: var(--text-muted); }

/* ── Pipeline ── */
.pipeline-flow { display: flex; align-items: stretch; gap: 0; margin: 8px 0 0; }
.pipe-stage { flex: 1; text-align: center; padding: 20px 12px 16px; border: 2px solid var(--border); border-right: none; position: relative; background: var(--bg-card); }
.pipe-stage:first-child { border-radius: 8px 0 0 8px; }
.pipe-stage:last-child { border-right: 2px solid var(--border); border-radius: 0 8px 8px 0; }
.pipe-stage::after { content: ''; position: absolute; right: -10px; top: 50%; transform: translateY(-50%); width: 0; height: 0; border: 8px solid transparent; border-left: 8px solid var(--border); z-index: 2; }
.pipe-stage:last-child::after { display: none; }
.pipe-stage::before { content: ''; position: absolute; right: -8px; top: 50%; transform: translateY(-50%); width: 0; height: 0; border: 6px solid transparent; border-left: 6px solid var(--bg-card); z-index: 3; }
.pipe-stage:last-child::before { display: none; }
.pipe-stage:hover { background: var(--bg-muted); }
.pipe-num { font-family: var(--font-mono); font-size: 1.6rem; font-weight: 700; color: var(--text-primary); letter-spacing: -0.03em; }
.pipe-name { font-family: var(--font-mono); font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-top: 4px; }
.pipe-detail { font-size: 0.75rem; color: var(--text-secondary); margin-top: 6px; line-height: 1.4; }

/* ── Source Books ── */
.books-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 24px; }
.book-card { padding: 14px 16px; border: 2px solid var(--border); border-radius: 6px; background: var(--bg-card); transition: all 0.15s; cursor: default; }
.book-card:hover { border-color: var(--border-hard); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
.book-card .book-name { font-weight: 600; font-size: 0.82rem; margin-bottom: 2px; display: flex; align-items: center; gap: 6px; }
.book-card .book-meta { font-family: var(--font-mono); font-size: 0.68rem; color: var(--text-muted); }

/* ── Entity Types ── */
.entity-strip { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0; border: 2px solid var(--border-hard); border-radius: 8px; overflow: hidden; margin-bottom: 24px; }
.entity-col { padding: 20px 18px; border-right: 1px solid var(--border); text-align: center; background: var(--bg-card); cursor: pointer; transition: background 0.15s; }
.entity-col:last-child { border-right: none; }
.entity-col:hover { background: var(--bg-surface); }
.entity-col .e-count { font-family: var(--font-mono); font-size: 2rem; font-weight: 700; letter-spacing: -0.03em; }
.entity-col .e-label { font-family: var(--font-mono); font-size: 0.62rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1.2px; margin-top: 2px; }
.entity-col .e-bar { height: 4px; border-radius: 2px; margin-top: 10px; }
.entity-samples { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.e-sample { padding: 14px 16px; border-left: 3px solid; background: var(--bg-card); border-radius: 0 6px 6px 0; font-size: 0.8rem; line-height: 1.6; color: var(--text-body); }
.e-sample .e-sample-label { font-family: var(--font-mono); font-size: 0.6rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }

/* ── Annotated Prose (the key visual) ── */
.annotated-block { background: var(--bg-card); border: 2px solid var(--border-hard); border-radius: 8px; overflow: hidden; }
.annotated-header { padding: 12px 20px; border-bottom: 2px dashed var(--border-dashed); display: flex; align-items: center; justify-content: space-between; }
.annotated-header .ah-label { font-family: var(--font-mono); font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); }
.annotated-header .ah-hint { font-size: 0.72rem; color: var(--text-muted); }
.annotated-body { padding: 24px 28px; font-size: 0.92rem; line-height: 2; color: var(--text-body); }
.annotated-body .scenario { font-size: 1rem; font-weight: 600; color: var(--text-primary); margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px dashed var(--border-dashed); }
.hl { padding: 2px 5px; border-radius: 3px; cursor: pointer; transition: all 0.15s; position: relative; font-weight: 500; }
.hl:hover { filter: brightness(0.95); }
.hl.hl-active { filter: brightness(0.88); outline: 2px solid currentColor; outline-offset: 1px; }
.hl-popover { position: absolute; z-index: 100; background: var(--bg-card); border: 2px solid var(--border-hard); border-radius: 6px; width: 320px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); opacity: 0; pointer-events: none; transition: opacity 0.15s; }
.hl-popover.visible { opacity: 1; pointer-events: auto; }
.hl-popover-header { padding: 8px 12px; border-bottom: 1px dashed var(--border-dashed); display: flex; align-items: center; gap: 6px; }
.hl-popover-header .pop-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.hl-popover-header .pop-source { font-family: var(--font-mono); font-size: 0.62rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; }
.hl-popover-header .pop-tag { font-family: var(--font-mono); font-size: 0.55rem; font-weight: 600; padding: 1px 5px; border-radius: 3px; margin-left: auto; }
.hl-popover-body { padding: 10px 12px; }
.hl-popover-body .pop-concept { font-size: 0.78rem; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; }
.hl-popover-body .pop-desc { font-size: 0.72rem; color: var(--text-body); line-height: 1.5; }
.hl-popover-footer { padding: 6px 12px 8px; border-top: 1px dashed var(--border-dashed); }
.hl-popover-footer a { font-family: var(--font-mono); font-size: 0.58rem; text-decoration: none; font-weight: 600; letter-spacing: 0.5px; }
.hl-asf { background: var(--book-asf-hl); border-bottom: 2px solid var(--book-asf); }
.hl-nsfd { background: var(--book-nsfd-hl); border-bottom: 2px solid var(--book-nsfd); }
.hl-gty { background: var(--book-gty-hl); border-bottom: 2px solid var(--book-gty); }
.hl-3dn { background: var(--book-3dn-hl); border-bottom: 2px solid var(--book-3dn); }
.sup { font-family: var(--font-mono); font-size: 0.58rem; font-weight: 700; vertical-align: super; margin-left: 1px; padding: 1px 4px; border-radius: 3px; }
.sup-asf { color: var(--book-asf); background: var(--book-asf-hl); }
.sup-nsfd { color: var(--book-nsfd); background: var(--book-nsfd-hl); }
.sup-gty { color: var(--book-gty); background: var(--book-gty-hl); }
.sup-3dn { color: var(--book-3dn); background: var(--book-3dn-hl); }
.annotated-footer { padding: 14px 20px; border-top: 2px dashed var(--border-dashed); background: var(--bg-surface); }
.annotated-footer .af-label { font-family: var(--font-mono); font-size: 0.6rem; text-transform: uppercase; letter-spacing: 1px; color: var(--book-asf); font-weight: 600; margin-bottom: 4px; }
.annotated-footer p { font-size: 0.82rem; color: var(--text-body); line-height: 1.6; }

/* ── Compare ── */
.compare-tabs { display: flex; gap: 4px; margin-bottom: 20px; }
.compare-tab { font-family: var(--font-mono); padding: 7px 16px; border-radius: 4px; border: 2px solid transparent; background: transparent; font-size: 0.7rem; font-weight: 600; cursor: pointer; color: var(--text-muted); transition: all 0.15s; text-transform: uppercase; letter-spacing: 0.5px; }
.compare-tab.active { color: var(--text-primary); border-color: var(--border-hard); background: var(--bg-card); }
.compare-tab:hover { color: var(--text-primary); }
.compare-panels { display: grid; grid-template-columns: 1fr 1fr; gap: 0; border: 2px solid var(--border-hard); border-radius: 8px; overflow: hidden; }
.compare-panel { padding: 24px; background: var(--bg-card); }
.compare-panel.left { border-right: 1px dashed var(--border-dashed); }
.compare-panel h4 { font-family: var(--font-serif); font-size: 1.05rem; margin-bottom: 2px; display: flex; align-items: center; gap: 8px; }
.compare-panel h4 .cdot { width: 10px; height: 10px; border-radius: 2px; flex-shrink: 0; }
.compare-panel .author { font-family: var(--font-mono); font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 14px; }
.compare-approach { font-size: 0.84rem; color: var(--text-body); line-height: 1.75; }
.compare-approach strong { color: var(--text-primary); }
.compare-synth { margin-top: 16px; padding: 16px 24px; border: 2px solid var(--border); border-radius: 8px; background: var(--bg-surface); text-align: center; }
.compare-synth .cs-label { font-family: var(--font-mono); font-size: 0.6rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1.2px; color: var(--book-asf); margin-bottom: 6px; }
.compare-synth p { font-size: 0.84rem; color: var(--text-body); line-height: 1.6; }

/* ── Tags ── */
.tag-cloud { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; padding: 16px 0; }
.tag-bubble { font-family: var(--font-sans); padding: 5px 12px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; cursor: pointer; transition: all 0.15s; border: 1px solid; position: relative; }
.tag-bubble:hover { transform: translateY(-2px); box-shadow: 0 3px 8px rgba(0,0,0,0.08); z-index: 2; }
.tag-bubble .tag-detail { position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%); background: var(--text-primary); color: #fff; padding: 10px 14px; border-radius: 6px; font-size: 0.72rem; font-weight: 400; width: 200px; opacity: 0; pointer-events: none; transition: opacity 0.15s; z-index: 10; text-align: left; line-height: 1.5; }
.tag-bubble .tag-detail::after { content: ''; position: absolute; top: 100%; left: 50%; transform: translateX(-50%); border: 5px solid transparent; border-top-color: var(--text-primary); }
.tag-bubble:hover .tag-detail { opacity: 1; }
.tag-bubble .tag-detail .td-bar { display: flex; gap: 2px; margin-top: 6px; height: 6px; border-radius: 3px; overflow: hidden; }
.tag-bubble .tag-detail .td-seg { height: 100%; }

/* ── Trace ── */
.trace-container { border: 2px solid var(--border-hard); border-radius: 8px; overflow: hidden; }
.trace-header { padding: 10px 20px; background: var(--bg-muted); border-bottom: 2px solid var(--border); font-family: var(--font-mono); font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); }
.trace-step { display: grid; grid-template-columns: 52px 1fr 260px; gap: 0; opacity: 0.3; transition: all 0.3s; cursor: pointer; border-bottom: 1px dashed var(--border-dashed); background: var(--bg-card); }
.trace-step:last-child { border-bottom: none; }
.trace-step.active { opacity: 1; }
.trace-step:hover { background: var(--bg-surface); }
.step-num-col { display: flex; align-items: center; justify-content: center; border-right: 1px dashed var(--border-dashed); font-family: var(--font-mono); font-size: 0.82rem; font-weight: 700; color: var(--text-muted); padding: 16px 0; }
.trace-step.active .step-num-col { color: var(--book-asf); }
.step-content { padding: 16px 20px; }
.step-content h4 { font-size: 0.88rem; font-weight: 600; margin-bottom: 4px; }
.step-content p { font-size: 0.82rem; color: var(--text-body); line-height: 1.5; }
.step-output { padding: 16px 18px; border-left: 1px dashed var(--border-dashed); background: var(--bg-surface); font-family: var(--font-mono); font-size: 0.72rem; color: var(--text-secondary); line-height: 1.6; }
.step-output .so-label { font-size: 0.58rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 6px; }
.step-output code { background: var(--bg-muted); padding: 1px 5px; border-radius: 3px; font-size: 0.7rem; color: var(--text-primary); }

/* ── Ecosystem ── */
.eco-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 8px; }
.eco-link { display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 4px; text-decoration: none; color: var(--text-primary); border: 1px solid var(--border); font-size: 0.78rem; transition: all 0.15s; background: var(--bg-card); }
.eco-link:hover { border-color: var(--border-hard); transform: translateX(2px); box-shadow: 0 2px 6px rgba(0,0,0,0.04); }
.eco-badge { font-family: var(--font-mono); font-size: 0.55rem; font-weight: 700; padding: 2px 7px; border-radius: 3px; text-transform: uppercase; letter-spacing: 0.8px; flex-shrink: 0; }
.eco-badge.arch { background: var(--blue-hl); color: var(--blue); border: 1px solid rgba(37,99,235,0.2); }
.eco-badge.product { background: var(--green-hl); color: var(--green); border: 1px solid rgba(5,150,105,0.2); }
.eco-badge.design { background: var(--pink-hl); color: var(--pink); border: 1px solid rgba(190,24,93,0.2); }
.eco-badge.meeting { background: var(--amber-hl); color: var(--amber); border: 1px solid rgba(217,119,6,0.2); }
.eco-badge.guide { background: var(--book-asf-hl); color: var(--book-asf); border: 1px solid rgba(123,94,167,0.2); }

/* ── Footer ── */
.page-footer { text-align: center; padding: 32px 40px; font-size: 0.75rem; color: var(--text-muted); font-family: var(--font-mono); letter-spacing: 0.3px; }
.page-footer a { color: var(--text-secondary); text-decoration: none; }
.page-footer a:hover { text-decoration: underline; }

/* ── Responsive ── */
@media (max-width: 700px) {
  .hero { padding: 36px 20px 32px; }
  .hero h1 { font-size: 1.6rem; }
  .hero-stats { gap: 20px; flex-wrap: wrap; }
  .section { padding: 32px 20px 40px; }
  .books-grid { grid-template-columns: 1fr 1fr; }
  .entity-strip { grid-template-columns: 1fr 1fr; }
  .entity-strip .entity-col:nth-child(2) { border-right: none; }
  .entity-strip .entity-col:nth-child(3) { border-top: 1px solid var(--border); }
  .entity-strip .entity-col:nth-child(4) { border-top: 1px solid var(--border); }
  .entity-samples { grid-template-columns: 1fr; }
  .pipeline-flow { flex-direction: column; }
  .pipe-stage { border-right: 2px solid var(--border) !important; border-bottom: none; }
  .pipe-stage:first-child { border-radius: 8px 8px 0 0; }
  .pipe-stage:last-child { border-radius: 0 0 8px 8px; border-bottom: 2px solid var(--border); }
  .pipe-stage::after, .pipe-stage::before { display: none; }
  .compare-panels { grid-template-columns: 1fr; }
  .compare-panel.left { border-right: none; border-bottom: 1px dashed var(--border-dashed); }
  .trace-step { grid-template-columns: 40px 1fr; }
  .step-output { grid-column: 1 / -1; border-left: none; border-top: 1px dashed var(--border-dashed); }
  .pill-nav { padding: 10px 12px 8px; }
  .annotated-body { padding: 18px 20px; font-size: 0.86rem; }
}
</style>
</head>
<body>

<!-- HERO -->
<div class="hero">
  <h1>Inside Ali's Conversation Engine</h1>
  <p class="subtitle">How 969 coaching items from 4 expert sources become personalized negotiation advice</p>
  <div class="hero-stats">
    <div class="hero-stat"><div class="num">969</div><div class="label">Items</div></div>
    <div class="hero-stat"><div class="num">4</div><div class="label">Sources</div></div>
    <div class="hero-stat"><div class="num">60</div><div class="label">Tags</div></div>
    <div class="hero-stat"><div class="num">5</div><div class="label">Types</div></div>
  </div>
</div>

<!-- NAV -->
<nav class="pill-nav" id="pillNav">
  <button class="pill-btn active" data-section="pipeline">Pipeline</button>
  <button class="pill-btn" data-section="entities">Entities</button>
  <button class="pill-btn" data-section="crossbook">Cross-Book</button>
  <button class="pill-btn" data-section="compare">Compare</button>
  <button class="pill-btn" data-section="tags">Tags</button>
  <button class="pill-btn" data-section="trace">Trace</button>
  <button class="pill-btn" data-section="ecosystem">Ecosystem</button>
</nav>

<!-- ═══ 1. PIPELINE ═══ -->
<div class="section" id="pipeline">
  <div class="section-label">01 / Pipeline</div>
  <h2 class="section-title">The Data Pipeline</h2>
  <p class="section-desc">From expert negotiation books to personalized coaching. Every response is grounded in real methodology.</p>

  <div class="pipeline-flow">
    <div class="pipe-stage">
      <div class="pipe-num">4</div>
      <div class="pipe-name">Sources</div>
      <div class="pipe-detail">Expert negotiation books + Aligned framework</div>
    </div>
    <div class="pipe-stage">
      <div class="pipe-num" style="font-size:1.2rem;">AI</div>
      <div class="pipe-name">Extraction</div>
      <div class="pipe-detail">Chapter-by-chapter entity identification</div>
    </div>
    <div class="pipe-stage">
      <div class="pipe-num">969</div>
      <div class="pipe-name">Entity Store</div>
      <div class="pipe-detail">Tagged coaching items across 5 types</div>
    </div>
    <div class="pipe-stage">
      <div class="pipe-num" style="font-size:1.2rem;">&#9881;</div>
      <div class="pipe-name">Assembly</div>
      <div class="pipe-detail">Context-matched prompt construction</div>
    </div>
    <div class="pipe-stage">
      <div class="pipe-num" style="font-size:1.2rem;">&#10003;</div>
      <div class="pipe-name">Response</div>
      <div class="pipe-detail">Personalized multi-source coaching</div>
    </div>
  </div>

  <div class="books-grid">
    <div class="book-card">
      <div class="book-name"><span class="legend-dot" style="background:var(--book-gty)"></span> Getting to Yes</div>
      <div class="book-meta">Fisher & Ury &middot; 233 items</div>
    </div>
    <div class="book-card">
      <div class="book-name"><span class="legend-dot" style="background:var(--book-nsfd)"></span> Never Split the Difference</div>
      <div class="book-meta">Chris Voss &middot; 287 items</div>
    </div>
    <div class="book-card">
      <div class="book-name"><span class="legend-dot" style="background:var(--book-3dn)"></span> 3-D Negotiation</div>
      <div class="book-meta">Lax & Sebenius &middot; 379 items</div>
    </div>
    <div class="book-card">
      <div class="book-name"><span class="legend-dot" style="background:var(--book-asf)"></span> Aligned Framework</div>
      <div class="book-meta">ASF Methodology &middot; 70 items</div>
    </div>
  </div>
</div>

<div class="grad-divider"></div>

<!-- ═══ 2. ENTITIES ═══ -->
<div class="section" id="entities">
  <div class="section-label">02 / Entity Types</div>
  <h2 class="section-title">969 Items, 4 Types</h2>
  <p class="section-desc">Every extracted item is classified. Click any type to explore in the <a href="https://tchat192.github.io/ali-stakeholder-docs/docs/book-extraction-review.html" target="_blank" style="color:var(--book-asf);text-decoration:underline">Book Extraction Review</a>.</p>

  <div class="entity-strip">
    <div class="entity-col" onclick="window.open('https://tchat192.github.io/ali-stakeholder-docs/docs/book-extraction-review.html','_blank')">
      <div class="e-count" style="color:var(--blue)">455</div>
      <div class="e-label" style="color:var(--blue)">Coaching Moves</div>
      <div class="e-bar" style="background:var(--blue);width:100%"></div>
    </div>
    <div class="entity-col" onclick="window.open('https://tchat192.github.io/ali-stakeholder-docs/docs/book-extraction-review.html','_blank')">
      <div class="e-count" style="color:var(--amber)">161</div>
      <div class="e-label" style="color:var(--amber)">Quotes</div>
      <div class="e-bar" style="background:var(--amber);width:35%"></div>
    </div>
    <div class="entity-col" onclick="window.open('https://tchat192.github.io/ali-stakeholder-docs/docs/book-extraction-review.html','_blank')">
      <div class="e-count" style="color:var(--pink)">146</div>
      <div class="e-label" style="color:var(--pink)">Frameworks</div>
      <div class="e-bar" style="background:var(--pink);width:32%"></div>
    </div>
    <div class="entity-col" onclick="window.open('https://tchat192.github.io/ali-stakeholder-docs/docs/book-extraction-review.html','_blank')">
      <div class="e-count" style="color:var(--green)">133</div>
      <div class="e-label" style="color:var(--green)">Examples</div>
      <div class="e-bar" style="background:var(--green);width:29%"></div>
    </div>
  </div>

  <div class="entity-samples">
    <div class="e-sample" style="border-left-color:var(--blue)">
      <div class="e-sample-label" style="color:var(--blue)">Coaching Move &middot; Getting to Yes</div>
      "Reject both soft and hard negotiating styles in favor of principled negotiation: decide issues on their merits rather than through haggling focused on positions."
    </div>
    <div class="e-sample" style="border-left-color:var(--pink)">
      <div class="e-sample-label" style="color:var(--pink)">Framework &middot; Never Split the Difference</div>
      "An agreement alone is insufficient. The true measure of success is implementation and execution -- a signed contract has no value until it produces results."
    </div>
    <div class="e-sample" style="border-left-color:var(--green)">
      <div class="e-sample-label" style="color:var(--green)">Example &middot; 3-D Negotiation</div>
      "Steve Perlman mapped backward: VCs would be more interested if Sony was already on board. He negotiated with Sony first, then leveraged that partnership."
    </div>
    <div class="e-sample" style="border-left-color:var(--amber)">
      <div class="e-sample-label" style="color:var(--amber)">Quote &middot; Getting to Yes</div>
      "Negotiation is a basic means of getting what you want from others -- back-and-forth communication designed to reach an agreement."
    </div>
  </div>
</div>

<div class="grad-divider"></div>

<!-- ═══ 3. CROSS-BOOK ═══ -->
<div class="section" id="crossbook">
  <div class="section-label">03 / Cross-Book Intelligence</div>
  <h2 class="section-title">Annotated Response</h2>
  <p class="section-desc">Ali doesn't quote one book. It blends insights from all four sources into a single response. Highlighted phrases show which source contributes each piece of advice.</p>

  <div class="legend">
    <div class="legend-title">Sources &mdash; Color Coded</div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--book-asf)"></span> Aligned <span class="legend-count">ASF</span></div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--book-nsfd)"></span> Voss <span class="legend-count">NSFD</span></div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--book-gty)"></span> Fisher/Ury <span class="legend-count">GTY</span></div>
    <div class="legend-item"><span class="legend-dot" style="background:var(--book-3dn)"></span> Lax/Sebenius <span class="legend-count">3DN</span></div>
  </div>

  <div class="annotated-block">
    <div class="annotated-header">
      <span class="ah-label">Annotated Prompt &mdash; Anatomy</span>
      <span class="ah-hint">Click any highlight to see its source context</span>
    </div>
    <div class="annotated-body">
      <div class="scenario">"My supplier keeps stone-walling me on price. They won't budge. What do I do?"</div>

      First, let's step back and <span class="hl hl-asf" data-hl="asf-classify">classify what's happening here</span><span class="sup sup-asf">ASF</span>. This is a <span class="hl hl-asf" data-hl="asf-types">Trading negotiation in the Bargaining phase</span><span class="sup sup-asf">ASF</span> -- your supplier has anchored on a number and is refusing to move. Before reacting, let's <span class="hl hl-asf" data-hl="asf-diagnostic">deploy diagnostic questions to understand their real constraints</span><span class="sup sup-asf">ASF</span>.

      <br><br>

      Start with <span class="hl hl-nsfd" data-hl="nsfd-calibrated">calibrated questions</span><span class="sup sup-nsfd">NSFD</span>: <span class="hl hl-nsfd" data-hl="nsfd-how">"How am I supposed to do that?"</span><span class="sup sup-nsfd">NSFD</span> creates empathy without confrontation. Then use <span class="hl hl-nsfd" data-hl="nsfd-labels">labels like "It seems like price is the only lever you're willing to discuss"</span><span class="sup sup-nsfd">NSFD</span> -- this forces them to either elaborate on their constraints or open up other dimensions of the deal.

      <br><br>

      The key insight: <span class="hl hl-gty" data-hl="gty-interests">move beyond positional bargaining by separating interests from positions</span><span class="sup sup-gty">GTY</span>. Your supplier says "the price is $X" -- that's a position. Their interest might be cash flow timing, volume predictability, or exclusivity. <span class="hl hl-gty" data-hl="gty-options">Brainstorm alternatives: payment terms, volume commitments, multi-year contracts, exclusivity in exchange for pricing</span><span class="sup sup-gty">GTY</span>. Use <span class="hl hl-gty" data-hl="gty-criteria">objective criteria -- market rates, competitor bids, industry benchmarks</span><span class="sup sup-gty">GTY</span> -- as your anchor.

      <br><br>

      But here's the move that changes everything: <span class="hl hl-3dn" data-hl="3dn-away">before your next meeting, change the game away from the table</span><span class="sup sup-3dn">3DN</span>. <span class="hl hl-3dn" data-hl="3dn-batna">Bring in a competing supplier bid</span><span class="sup sup-3dn">3DN</span> to shift your BATNA. <span class="hl hl-3dn" data-hl="3dn-restructure">Restructure the deal to include elements where their costs are lower than their price</span><span class="sup sup-3dn">3DN</span>. <span class="hl hl-3dn" data-hl="3dn-stakeholders">Map the stakeholders on their side -- who actually has authority to move on price?</span><span class="sup sup-3dn">3DN</span> Sometimes the person you're talking to literally can't budge.
    </div>
    <div class="annotated-footer">
      <div class="af-label">Ali's Synthesis</div>
      <p>Four sources, one response: diagnose the type <span class="sup sup-asf">ASF</span>, use calibrated questions to break the impasse <span class="sup sup-nsfd">NSFD</span>, expand the pie with creative options <span class="sup sup-gty">GTY</span>, and restructure the deal setup before returning to the table <span class="sup sup-3dn">3DN</span>.</p>
    </div>
  </div>
</div>

<div class="grad-divider"></div>

<!-- ═══ 4. COMPARE ═══ -->
<div class="section" id="compare">
  <div class="section-label">04 / Compare</div>
  <h2 class="section-title">Side-by-Side</h2>
  <p class="section-desc">Different books tackle the same challenges from different angles. Ali uses both.</p>

  <div class="compare-tabs" id="compareTabs">
    <button class="compare-tab active" data-scenario="difficult">Difficult Counterparty</button>
    <button class="compare-tab" data-scenario="opening">Opening Moves</button>
    <button class="compare-tab" data-scenario="closing">Closing the Deal</button>
  </div>

  <div id="compareContent"></div>
</div>

<div class="grad-divider"></div>

<!-- ═══ 5. TAGS ═══ -->
<div class="section" id="tags">
  <div class="section-label">05 / Tag Landscape</div>
  <h2 class="section-title">60 Topics</h2>
  <p class="section-desc">Size = frequency. Color = dominant book source. Hover for per-book breakdown.</p>
  <div class="tag-cloud" id="tagCloud"></div>
</div>

<div class="grad-divider"></div>

<!-- ═══ 6. TRACE ═══ -->
<div class="section" id="trace">
  <div class="section-label">06 / Conversation Trace</div>
  <h2 class="section-title">Inside a Live Conversation</h2>
  <p class="section-desc">Click each step to reveal what happens behind the scenes when a user talks to Ali.</p>

  <div class="trace-container" id="traceContainer">
    <div class="trace-header">User Session &middot; Salary Negotiation &middot; Silhouette: Mediator</div>

    <div class="trace-step active" data-step="1">
      <div class="step-num-col">01</div>
      <div class="step-content">
        <h4>User Speaks</h4>
        <p>"I have a salary negotiation coming up. My manager always deflects when I bring up compensation."</p>
      </div>
      <div class="step-output">
        <div class="so-label">Input</div>
        Raw text captured<br>
        Silhouette: <code>Mediator</code><br>
        Session: first message
      </div>
    </div>

    <div class="trace-step" data-step="2">
      <div class="step-num-col">02</div>
      <div class="step-content">
        <h4>Type Classified</h4>
        <p>Classification engine identifies this as a <strong>Trading</strong> negotiation with salary-specific signals.</p>
      </div>
      <div class="step-output">
        <div class="so-label">Output</div>
        Type: <code>Trading</code><br>
        Signals: <code>salary</code> <code>compensation</code> <code>manager</code><br>
        Confidence: <code>0.92</code>
      </div>
    </div>

    <div class="trace-step" data-step="3">
      <div class="step-num-col">03</div>
      <div class="step-content">
        <h4>Phase Detected</h4>
        <p>User is in <strong>Preparation</strong> phase -- the negotiation hasn't happened yet.</p>
      </div>
      <div class="step-output">
        <div class="so-label">Output</div>
        Phase: <code>Preparation</code><br>
        Indicators: future tense<br>
        Tone: anxious, seeking guidance
      </div>
    </div>

    <div class="trace-step" data-step="4">
      <div class="step-num-col">04</div>
      <div class="step-content">
        <h4>Entities Retrieved</h4>
        <p>12 relevant items light up across all 4 sources, matched by tags: <em>salary, preparation, communication, difficult_people</em>.</p>
      </div>
      <div class="step-output">
        <div class="so-label">Matched (12/969)</div>
        <span style="color:var(--book-nsfd)">Voss:</span> 4 items<br>
        <span style="color:var(--book-gty)">Fisher/Ury:</span> 3 items<br>
        <span style="color:var(--book-3dn)">Lax/Sebenius:</span> 3 items<br>
        <span style="color:var(--book-asf)">Aligned:</span> 2 items
      </div>
    </div>

    <div class="trace-step" data-step="5">
      <div class="step-num-col">05</div>
      <div class="step-content">
        <h4>Response Generated</h4>
        <p>Coaching response assembled for the Mediator personality type with multi-source callouts.</p>
      </div>
      <div class="step-output">
        <div class="so-label">Ali (excerpt)</div>
        "Before your conversation, let's build your preparation toolkit. As a Mediator, your strength is reading the room. First, define your <strong>BATNA</strong>. Then, prepare two <strong>calibrated questions</strong>..."
      </div>
    </div>
  </div>
</div>

<div class="grad-divider"></div>

<!-- ═══ 7. ECOSYSTEM ═══ -->
<div class="section" id="ecosystem">
  <div class="section-label">07 / Ecosystem</div>
  <h2 class="section-title">Connected Artifacts</h2>
  <p class="section-desc">This visualization is one piece of a living, interconnected documentation system.</p>
  <div class="eco-grid" id="ecoGrid"></div>
</div>

<div class="page-footer">
  Ali MVP &middot; Aligned Negotiation Platform &middot;
  <a href="../index.html">Stakeholder Hub</a> &middot; Feb 2026
</div>

<script>
const TAG_DATA = [
  {tag:"communication",count:444,gty:125,nsfd:182,dn:137,dominant:"nsfd"},
  {tag:"leverage",count:342,gty:85,nsfd:108,dn:149,dominant:"dn"},
  {tag:"preparation",count:326,gty:81,nsfd:58,dn:187,dominant:"dn"},
  {tag:"power_dynamics",count:323,gty:84,nsfd:120,dn:119,dominant:"nsfd"},
  {tag:"relationship",count:235,gty:76,nsfd:78,dn:81,dominant:"dn"},
  {tag:"creativity",count:174,gty:35,nsfd:12,dn:127,dominant:"dn"},
  {tag:"emotions",count:167,gty:46,nsfd:99,dn:22,dominant:"nsfd"},
  {tag:"information_gathering",count:165,gty:30,nsfd:80,dn:55,dominant:"nsfd"},
  {tag:"closing",count:118,gty:24,nsfd:32,dn:62,dominant:"dn"},
  {tag:"business_deals",count:93,gty:7,nsfd:9,dn:77,dominant:"dn"},
  {tag:"opening",count:90,gty:20,nsfd:14,dn:56,dominant:"dn"},
  {tag:"difficult_people",count:82,gty:32,nsfd:35,dn:15,dominant:"nsfd"},
  {tag:"anchoring",count:66,gty:5,nsfd:25,dn:36,dominant:"dn"},
  {tag:"alternatives",count:66,gty:45,nsfd:7,dn:14,dominant:"gty"},
  {tag:"ethics",count:57,gty:33,nsfd:7,dn:17,dominant:"gty"},
  {tag:"team_negotiation",count:48,gty:6,nsfd:11,dn:31,dominant:"dn"},
  {tag:"strategy",count:35,gty:12,nsfd:2,dn:21,dominant:"dn"},
  {tag:"deal_design",count:29,gty:0,nsfd:0,dn:29,dominant:"dn"},
  {tag:"concessions",count:27,gty:4,nsfd:17,dn:6,dominant:"nsfd"},
  {tag:"psychology",count:24,gty:0,nsfd:21,dn:3,dominant:"nsfd"},
  {tag:"examples",count:22,gty:2,nsfd:11,dn:9,dominant:"nsfd"},
  {tag:"bargaining",count:17,gty:0,nsfd:17,dn:0,dominant:"nsfd"},
  {tag:"salary",count:15,gty:4,nsfd:11,dn:0,dominant:"nsfd"},
  {tag:"cultural",count:14,gty:1,nsfd:0,dn:13,dominant:"dn"},
  {tag:"perception",count:12,gty:12,nsfd:0,dn:0,dominant:"gty"},
  {tag:"quotes",count:9,gty:0,nsfd:0,dn:9,dominant:"dn"},
  {tag:"setup",count:9,gty:0,nsfd:0,dn:9,dominant:"dn"},
  {tag:"philosophy",count:6,gty:0,nsfd:3,dn:3,dominant:"nsfd"},
  {tag:"process",count:5,gty:2,nsfd:0,dn:3,dominant:"dn"},
  {tag:"sequencing",count:5,gty:1,nsfd:0,dn:4,dominant:"dn"},
  {tag:"execution",count:5,gty:0,nsfd:5,dn:0,dominant:"nsfd"},
  {tag:"trust",count:5,gty:0,nsfd:0,dn:5,dominant:"dn"},
  {tag:"problem_solving",count:5,gty:0,nsfd:0,dn:5,dominant:"dn"},
];

const BOOK_COLORS = { gty:"#22a06b", nsfd:"#7c7fc4", dn:"#4a8ec2", asf:"#7b5ea7" };

const COMPARE_DATA = {
  difficult: {
    left: { book:"Getting to Yes", author:"Fisher & Ury", color:"var(--book-gty)",
      approach:'<strong>Principled Negotiation:</strong> Separate the people from the problem. Focus on interests, not positions. Don\'t react to emotional tactics -- instead, name the behavior: "I notice we keep returning to the same position." Use objective criteria: market rates, precedent, industry standards. If they play dirty tricks, call it out explicitly and negotiate the process itself.' },
    right: { book:"Never Split the Difference", author:"Chris Voss", color:"var(--book-nsfd)",
      approach:'<strong>Tactical Empathy:</strong> Mirror their last words to show you\'re listening. Use labels: "It seems like you feel this price is non-negotiable." Deploy calibrated questions: "How am I supposed to do that?" Embrace "No" -- it gives them a feeling of safety and control. Use the late-night FM DJ voice to de-escalate. Accusation audit upfront: "You probably think I\'m being unreasonable..."' },
    synthesis:'Ali blends both: use tactical empathy to build rapport, then pivot to principled criteria for the substance. The emotional toolkit from Voss creates the opening; the analytical framework from Fisher/Ury structures the solution.'
  },
  opening: {
    left: { book:"Getting to Yes", author:"Fisher & Ury", color:"var(--book-gty)",
      approach:'<strong>Explore Interests First:</strong> Don\'t open with a number. Ask questions to understand underlying interests. "Help me understand what\'s most important to you in this deal." Establish shared interests early to build a collaborative frame. Use the "one-text procedure" -- draft a single working document together.' },
    right: { book:"3-D Negotiation", author:"Lax & Sebenius", color:"var(--book-3dn)",
      approach:'<strong>Setup Before Substance:</strong> The most important moves happen before anyone sits down. Map all stakeholders. Sequence your conversations strategically -- talk to allies first to build momentum. Choose the right venue, timing, and framing. Set the agenda to favor your priorities. Bring the right people to the table.' },
    synthesis:'Ali combines both: do your 3-D setup work (sequencing, stakeholder mapping) before the meeting, then use interest-based questioning once you\'re at the table.'
  },
  closing: {
    left: { book:"Never Split the Difference", author:"Chris Voss", color:"var(--book-nsfd)",
      approach:'<strong>The Ackerman Model:</strong> Set your target price. First offer at 65% of target. Use calibrated questions and empathy between each increase. Move in decreasing increments: 85%, 95%, 100%. Use precise non-round numbers for your final offer. Throw in a non-monetary item to signal you\'re at your limit.' },
    right: { book:"3-D Negotiation", author:"Lax & Sebenius", color:"var(--book-3dn)",
      approach:'<strong>Create a Zone of Possible Agreement:</strong> Map both parties\' walkaway points. Design packages (not single issues) that create value in the zone. Use contingent agreements: "If X happens, we do Y." Build in implementation mechanisms -- the deal isn\'t done when you shake hands, it\'s done when value is delivered.' },
    synthesis:'Ali combines precise tactical anchoring from Voss with the strategic deal design from Lax/Sebenius to close deals that are both psychologically compelling and structurally sound.'
  }
};

const ECOSYSTEM_ITEMS = [
  {title:"Conversation Engine Architecture",url:"conversation-engine-architecture.html",badge:"arch",date:"Jan 26"},
  {title:"Classification Engine",url:"classification-engine.html",badge:"arch",date:"Jan 26"},
  {title:"V3 Classification Guide",url:"v3-classification-guide.html",badge:"arch",date:"Jan 26"},
  {title:"Technical Reference",url:"technical-reference-jan15.html",badge:"arch",date:"Jan 26"},
  {title:"Book Extraction Review",url:"../docs/book-extraction-review.html",badge:"arch",date:"Feb 26"},
  {title:"Product Brief #2",url:"../product/product-brief-2.html",badge:"product",date:"Jan 26"},
  {title:"Stakeholder Alignment",url:"../product/stakeholder-alignment-jan15.html",badge:"product",date:"Jan 26"},
  {title:"Product Roadmap",url:"../product/roadmap.html",badge:"product",date:"Jan 26"},
  {title:"Brand Registry",url:"../design/brand-registry.html",badge:"design",date:"Dec 25"},
  {title:"Design Tokens Guide",url:"../design/design-tokens-guide-nic.html",badge:"design",date:"Dec 25"},
  {title:"Zahir Design Session",url:"../design/zahir-design-session-jan25.html",badge:"design",date:"Jan 26"},
  {title:"Landing Page Copy",url:"../docs/landing-page-copy-review.html",badge:"product",date:"Jan 26"},
  {title:"Braintrust Eval Guide",url:"../guides/BRAINTRUST_EVAL_GUIDE.html",badge:"guide",date:"Feb 26"},
  {title:"Meeting Synthesis",url:"../meetings/2026-02-12/meeting-synthesis.html",badge:"meeting",date:"Feb 26"},
];

// NAV
document.querySelectorAll('.pill-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.pill-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.section)?.scrollIntoView({ behavior:'smooth', block:'start' });
  });
});
const sects = document.querySelectorAll('.section[id]');
new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      document.querySelectorAll('.pill-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`.pill-btn[data-section="${e.target.id}"]`)?.classList.add('active');
    }
  });
}, { rootMargin:'-40% 0px -40% 0px' }).observe && sects.forEach(s => new IntersectionObserver(entries => {
  entries.forEach(e => { if(e.isIntersecting) { document.querySelectorAll('.pill-btn').forEach(b=>b.classList.remove('active')); document.querySelector(`.pill-btn[data-section="${e.target.id}"]`)?.classList.add('active'); }});
}, {rootMargin:'-40% 0px -40% 0px'}).observe(s));

// TAGS
(function(){
  const cloud = document.getElementById('tagCloud');
  const max = TAG_DATA[0].count;
  TAG_DATA.forEach(t => {
    const s = 0.65 + (t.count/max)*0.55;
    const c = BOOK_COLORS[t.dominant];
    const el = document.createElement('span');
    el.className = 'tag-bubble';
    const total = t.gty+t.nsfd+t.dn;
    el.style.cssText = `font-size:${s}rem;background:${c}12;color:${c};border-color:${c}30;`;
    const label = t.tag.replace(/_/g,' ');
    el.innerHTML = `${label}&nbsp;<span style="opacity:0.5;font-family:var(--font-mono);font-size:0.7em">${t.count}</span>
      <span class="tag-detail"><strong>${label}</strong> &mdash; ${t.count} items<br>
      GTY: ${t.gty} &middot; NSFD: ${t.nsfd} &middot; 3DN: ${t.dn}
      <span class="td-bar"><span class="td-seg" style="background:${BOOK_COLORS.gty};flex:${t.gty}"></span><span class="td-seg" style="background:${BOOK_COLORS.nsfd};flex:${t.nsfd}"></span><span class="td-seg" style="background:${BOOK_COLORS.dn};flex:${t.dn}"></span></span></span>`;
    cloud.appendChild(el);
  });
})();

// COMPARE
function renderCompare(scenario) {
  const d = COMPARE_DATA[scenario];
  document.getElementById('compareContent').innerHTML = `
    <div class="compare-panels">
      <div class="compare-panel left">
        <h4><span class="cdot" style="background:${d.left.color}"></span>${d.left.book}</h4>
        <div class="author">${d.left.author}</div>
        <div class="compare-approach">${d.left.approach}</div>
      </div>
      <div class="compare-panel right">
        <h4><span class="cdot" style="background:${d.right.color}"></span>${d.right.book}</h4>
        <div class="author">${d.right.author}</div>
        <div class="compare-approach">${d.right.approach}</div>
      </div>
    </div>
    <div class="compare-synth"><div class="cs-label">How Ali Uses Both</div><p>${d.synthesis}</p></div>`;
}
renderCompare('difficult');
document.querySelectorAll('.compare-tab').forEach(t => t.addEventListener('click', () => {
  document.querySelectorAll('.compare-tab').forEach(x => x.classList.remove('active'));
  t.classList.add('active');
  renderCompare(t.dataset.scenario);
}));

// TRACE
document.querySelectorAll('.trace-step').forEach(step => {
  step.addEventListener('click', () => {
    const n = parseInt(step.dataset.step);
    document.querySelectorAll('.trace-step').forEach(s => s.classList.toggle('active', parseInt(s.dataset.step) <= n));
  });
});

// ECOSYSTEM
(function(){
  const grid = document.getElementById('ecoGrid');
  const labels = {arch:'Arch',product:'Product',design:'Design',meeting:'Meeting',guide:'Guide'};
  ECOSYSTEM_ITEMS.forEach(item => {
    const a = document.createElement('a');
    a.className = 'eco-link'; a.href = item.url; a.target = '_blank';
    a.innerHTML = `<span class="eco-badge ${item.badge}">${labels[item.badge]}</span><span>${item.title}</span><span style="margin-left:auto;font-family:var(--font-mono);font-size:0.62rem;color:var(--text-muted);white-space:nowrap">${item.date}</span>`;
    grid.appendChild(a);
  });
})();

// HIGHLIGHT POPOVERS
(function(){
  const popover = document.createElement('div');
  popover.className = 'hl-popover';
  document.body.appendChild(popover);

  const HL_DATA = {
    'asf-classify': { source:'Aligned Strategic Framework', tag:'C1', concept:'Four Negotiation Types',
      desc:'Every negotiation is classified as Bargaining, Trading, Creating, or Partnering. The type determines Ali\'s entire coaching approach.' },
    'asf-types': { source:'Aligned Strategic Framework', tag:'C1', concept:'Type Classification',
      desc:'Ali classifies the negotiation type before offering any tactical advice -- what questions to ask, what transparency to recommend, which tactics fit.' },
    'asf-diagnostic': { source:'Aligned Strategic Framework', tag:'NEW-2', concept:'Four Diagnostic Questions',
      desc:'Mark: "99.9% of the time we ask some form of those four questions." How many terms? How many alternatives? What\'s the intent? What\'s the relationship?' },
    'nsfd-calibrated': { source:'Never Split the Difference', tag:'Ch.7', concept:'Calibrated Questions',
      desc:'Open-ended "How" and "What" questions that force the counterparty to problem-solve on your behalf without feeling confronted.' },
    'nsfd-how': { source:'Never Split the Difference', tag:'Ch.7', concept:'"How Am I Supposed to Do That?"',
      desc:'Voss\'s signature calibrated question. Forces the other side to consider your constraints while creating tactical empathy.' },
    'nsfd-labels': { source:'Never Split the Difference', tag:'Ch.3', concept:'Labeling',
      desc:'Name the counterparty\'s emotions or positions to validate them: "It seems like..." This disarms defensiveness and opens dialogue.' },
    'gty-interests': { source:'Getting to Yes', tag:'Ch.3', concept:'Interests vs. Positions',
      desc:'Fisher & Ury\'s core principle: positions are what people say they want; interests are WHY they want it. Focus on interests to unlock solutions.' },
    'gty-options': { source:'Getting to Yes', tag:'Ch.4', concept:'Invent Options for Mutual Gain',
      desc:'Brainstorm creative alternatives before deciding. Separate inventing from deciding. Look for shared interests to expand the pie.' },
    'gty-criteria': { source:'Getting to Yes', tag:'Ch.5', concept:'Objective Criteria',
      desc:'Insist on using fair standards -- market value, precedent, industry benchmarks -- rather than a contest of wills.' },
    '3dn-away': { source:'3-D Negotiation', tag:'Ch.1', concept:'Away-from-the-Table Moves',
      desc:'Lax & Sebenius: the most powerful negotiations happen before anyone sits down. Change the setup, not just the substance.' },
    '3dn-batna': { source:'3-D Negotiation', tag:'Ch.5', concept:'BATNA Engineering',
      desc:'Don\'t just assess your alternatives -- actively improve them. Bring in competing bids to shift your walkaway power.' },
    '3dn-restructure': { source:'3-D Negotiation', tag:'Ch.8', concept:'Deal Design',
      desc:'Restructure the deal to create value: change the scope, sequence, or terms so both sides capture more.' },
    '3dn-stakeholders': { source:'3-D Negotiation', tag:'Ch.3', concept:'Stakeholder Mapping',
      desc:'Identify all parties who influence the deal. Map authority, interests, and relationships. Sometimes the person at the table can\'t say yes.' }
  };

  const BOOK_LINKS = {
    'Aligned Strategic Framework': { color:'var(--book-asf)', abbr:'ASF' },
    'Never Split the Difference': { color:'var(--book-nsfd)', abbr:'NSFD' },
    'Getting to Yes': { color:'var(--book-gty)', abbr:'GTY' },
    '3-D Negotiation': { color:'var(--book-3dn)', abbr:'3DN' }
  };

  function showPopover(hlEl) {
    const key = hlEl.dataset.hl;
    const d = HL_DATA[key];
    if (!d) return;
    const b = BOOK_LINKS[d.source];

    popover.innerHTML = `
      <div class="hl-popover-header">
        <span class="pop-dot" style="background:${b.color}"></span>
        <span class="pop-source" style="color:${b.color}">${d.source}</span>
        <span class="pop-tag" style="background:${b.color}15;color:${b.color}">${d.tag}</span>
      </div>
      <div class="hl-popover-body">
        <div class="pop-concept">${d.concept}</div>
        <div class="pop-desc">${d.desc}</div>
      </div>
      <div class="hl-popover-footer">
        <a href="https://tchat192.github.io/ali-stakeholder-docs/docs/book-extraction-review.html" target="_blank" style="color:${b.color}">View in Book Extraction Review &rarr;</a>
      </div>`;

    const rect = hlEl.getBoundingClientRect();
    const scrollY = window.scrollY;
    const scrollX = window.scrollX;
    let top = rect.bottom + scrollY + 8;
    let left = rect.left + scrollX + (rect.width / 2) - 160;
    left = Math.max(8, Math.min(left, window.innerWidth - 336));
    if (top + 200 > scrollY + window.innerHeight) {
      top = rect.top + scrollY - 8;
      popover.style.transform = 'translateY(-100%)';
    } else {
      popover.style.transform = 'none';
    }
    popover.style.top = top + 'px';
    popover.style.left = left + 'px';

    document.querySelectorAll('.hl.hl-active').forEach(h => h.classList.remove('hl-active'));
    hlEl.classList.add('hl-active');
    popover.classList.add('visible');
  }

  document.querySelectorAll('.hl[data-hl]').forEach(el => {
    el.addEventListener('click', (e) => {
      e.stopPropagation();
      if (el.classList.contains('hl-active')) {
        popover.classList.remove('visible');
        el.classList.remove('hl-active');
      } else {
        showPopover(el);
      }
    });
  });

  document.addEventListener('click', (e) => {
    if (!e.target.closest('.hl-popover') && !e.target.closest('.hl[data-hl]')) {
      popover.classList.remove('visible');
      document.querySelectorAll('.hl.hl-active').forEach(h => h.classList.remove('hl-active'));
    }
  });
})();
</script>
</body>
</html>
