<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ali V3 - Conversational Classification Architecture</title>
    <style>
        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --purple: #8b5cf6;
            --cyan: #06b6d4;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --muted: #64748b;
            --border: #e2e8f0;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 2rem; }

        /* Header */
        header {
            background: linear-gradient(135deg, #1e293b, #334155);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
        }
        header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        header p { opacity: 0.8; font-size: 1.1rem; }
        .badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        /* Cards */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .card h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .card h3 { font-size: 1rem; margin: 1.5rem 0 0.75rem; color: var(--text); }

        /* Flow Diagram */
        .flow-diagram {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Monaco', monospace;
            font-size: 0.85rem;
            line-height: 1.8;
            overflow-x: auto;
            white-space: pre;
        }

        /* Signal Cards */
        .signal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .signal-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
        }
        .signal-card h4 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .signal-card ul {
            font-size: 0.8rem;
            color: var(--muted);
            margin-left: 1rem;
        }
        .signal-card li { margin-bottom: 0.25rem; }

        /* Rules */
        .rule {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 1rem;
            margin: 0.75rem 0;
            border-radius: 0 8px 8px 0;
        }
        .rule strong { color: #92400e; }
        .rule code {
            background: #fef9c3;
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        /* Test Cases */
        .test-case {
            border: 1px solid var(--border);
            border-radius: 8px;
            margin: 1rem 0;
            overflow: hidden;
        }
        .test-header {
            background: var(--bg);
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
        }
        .test-header h4 { font-size: 0.9rem; }
        .test-tags { display: flex; gap: 0.5rem; }
        .tag {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .tag-trading { background: #f3e8ff; color: var(--purple); }
        .tag-bargaining { background: #dbeafe; color: var(--primary); }
        .tag-creating { background: #d1fae5; color: var(--success); }
        .tag-batna { background: #fee2e2; color: var(--danger); }
        .tag-partnering { background: #cffafe; color: var(--cyan); }
        .test-body { padding: 1rem; }
        .test-input {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            margin: 0.5rem 0;
        }

        /* Comparison Table */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
            margin: 1rem 0;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        th { background: var(--bg); font-weight: 600; }
        tr:hover { background: var(--bg); }

        /* Stats */
        .stats {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin: 1.5rem 0;
        }
        .stat { text-align: center; }
        .stat-value { font-size: 2rem; font-weight: 700; color: var(--primary); }
        .stat-label { font-size: 0.75rem; color: var(--muted); text-transform: uppercase; }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--muted);
            font-size: 0.875rem;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }

        /* Print */
        @media print {
            body { background: white; }
            .container { padding: 0; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Ali V3 Architecture</h1>
        <p>Conversational Classification with AI Inference</p>
        <span class="badge">Replaces V2 4-Round Batching</span>
        <div style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.7;">
            For Mark | November 24, 2025 | Terrance Chatman
        </div>
    </header>

    <div class="container">
        <!-- Key Change -->
        <div class="card">
            <h2>The Key Change</h2>
            <table>
                <tr>
                    <th>Aspect</th>
                    <th>V2 (Current)</th>
                    <th>V3 (Proposed)</th>
                </tr>
                <tr>
                    <td>Questions</td>
                    <td>4-8 explicit questions</td>
                    <td>1 opening + 0-2 follow-ups</td>
                </tr>
                <tr>
                    <td>UX</td>
                    <td>Survey-like</td>
                    <td>Natural conversation</td>
                </tr>
                <tr>
                    <td>Classification</td>
                    <td>Rule-based routing</td>
                    <td>AI signal inference</td>
                </tr>
                <tr>
                    <td>Total Interactions</td>
                    <td>4-8</td>
                    <td>1-3</td>
                </tr>
            </table>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value">1-3</div>
                    <div class="stat-label">Interactions (was 4-8)</div>
                </div>
                <div class="stat">
                    <div class="stat-value">100%</div>
                    <div class="stat-label">Test Accuracy</div>
                </div>
                <div class="stat">
                    <div class="stat-value">10/10</div>
                    <div class="stat-label">Edge Cases Handled</div>
                </div>
            </div>
        </div>

        <!-- Architecture Flow -->
        <div class="card">
            <h2>Architecture Flow</h2>
            <div class="flow-diagram">User: "Walk me through the deal..."
         │
         ▼
┌─────────────────────────────────────────┐
│      SIGNAL EXTRACTION ENGINE           │
│  Parses natural language for:           │
│  • Alternatives (BATNA)                 │
│  • Timeline/Urgency                     │
│  • Terms Complexity                     │
│  • Relationship Tenure                  │
│  • Trust Indicators                     │
│  • Joint Value Creation                 │
└─────────────────────────────────────────┘
         │
         ├── Confidence ≥ 80% ──► CLASSIFY (No follow-ups)
         │
         └── Confidence < 80% ──► ONE Targeted Follow-up
                                          │
                                          ▼
                                   CLASSIFY + OUTPUT</div>
        </div>

        <!-- Signal Extraction -->
        <div class="card">
            <h2>The Six Signals</h2>
            <p style="color: var(--muted); margin-bottom: 1rem;">AI extracts these from natural conversation—no explicit questions needed.</p>
            <div class="signal-grid">
                <div class="signal-card">
                    <h4>1. ALTERNATIVES</h4>
                    <ul>
                        <li><strong>HIGH:</strong> "got RFPs", "5 suppliers"</li>
                        <li><strong>MEDIUM:</strong> "could switch", "others exist"</li>
                        <li><strong>LOW:</strong> "locked in", "sole source"</li>
                    </ul>
                </div>
                <div class="signal-card">
                    <h4>2. TIMELINE</h4>
                    <ul>
                        <li><strong>URGENT:</strong> "need in 2 weeks"</li>
                        <li><strong>NORMAL:</strong> "renewal in X months"</li>
                        <li><strong>RELAXED:</strong> "no rush"</li>
                    </ul>
                </div>
                <div class="signal-card">
                    <h4>3. COMPLEXITY</h4>
                    <ul>
                        <li><strong>1-2 terms:</strong> → Bargaining</li>
                        <li><strong>3-5 terms:</strong> → Trading</li>
                        <li><strong>6+ terms:</strong> → Trading confirmed</li>
                    </ul>
                </div>
                <div class="signal-card">
                    <h4>4. TENURE</h4>
                    <ul>
                        <li><strong>&lt;2 years:</strong> Trading max</li>
                        <li><strong>2-5 years:</strong> Creating possible</li>
                        <li><strong>5+ years:</strong> Partnering possible</li>
                    </ul>
                </div>
                <div class="signal-card">
                    <h4>5. TRUST</h4>
                    <ul>
                        <li><strong>HIGH:</strong> "exceptional", "reliable"</li>
                        <li><strong>DEGRADED:</strong> "getting aggressive"</li>
                        <li><strong>LOW:</strong> "don't trust"</li>
                    </ul>
                </div>
                <div class="signal-card">
                    <h4>6. JOINT VALUE</h4>
                    <ul>
                        <li><strong>NONE:</strong> Transactional</li>
                        <li><strong>EXPLORING:</strong> "discussing"</li>
                        <li><strong>IMPLEMENTED:</strong> Active partnership</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Inference Rules -->
        <div class="card">
            <h2>8 Inference Rules (Edge Case Handling)</h2>
            <p style="color: var(--muted); margin-bottom: 1rem;">These rules prevent misclassification in ambiguous situations.</p>

            <div class="rule">
                <strong>Rule 1: Facts Override Feelings</strong><br>
                "I feel locked in" + alternatives mentioned → <code>Trust the RFPs, not the feeling</code>
            </div>
            <div class="rule">
                <strong>Rule 2: Complexity Overrides Attention</strong><br>
                "Just about price" + 12 terms listed → <code>Trust term count, not user focus</code>
            </div>
            <div class="rule">
                <strong>Rule 3: Tenure Threshold Is Hard</strong><br>
                Excellent 18-month relationship → <code>Still TRADING, not Creating yet</code>
            </div>
            <div class="rule">
                <strong>Rule 4: Current Behavior Overrides History</strong><br>
                7-year relationship + recent aggression → <code>Route to Trading, not Partnering</code>
            </div>
            <div class="rule">
                <strong>Rule 5: Choice ≠ Constraint</strong><br>
                Single source by preference → <code>Not BATNA Deficiency</code>
            </div>
            <div class="rule">
                <strong>Rule 6: Temporary ≠ Structural</strong><br>
                "Need in 2 weeks" + 10 suppliers exist → <code>Spot buy, not lock-in</code>
            </div>
            <div class="rule">
                <strong>Rule 7: Market Structure Dominates</strong><br>
                Great relationship + 20 suppliers → <code>Still Bargaining (commodity)</code>
            </div>
            <div class="rule">
                <strong>Rule 8: Timeline Math Overrides Perception</strong><br>
                6mo switch time &lt; 8mo renewal → <code>Alternatives ARE viable</code>
            </div>
        </div>

        <!-- Test Results -->
        <div class="card">
            <h2>Validation Results: 10/10 Edge Cases</h2>

            <div class="test-case">
                <div class="test-header">
                    <h4>Case 1: False Lock-in</h4>
                    <div class="test-tags">
                        <span class="tag tag-trading">TRADING ✓</span>
                        <span class="tag tag-batna" style="opacity: 0.5">Not BATNA</span>
                    </div>
                </div>
                <div class="test-body">
                    <div class="test-input">"We've been with SAP 8 years, I feel completely locked in. But we got RFPs from Oracle, Microsoft, Workday. Migration is 18 months, renewal in 24 months."</div>
                    <p><strong>Rule Applied:</strong> Facts Override Feelings</p>
                </div>
            </div>

            <div class="test-case">
                <div class="test-header">
                    <h4>Case 2: Commodity with Hidden Complexity</h4>
                    <div class="test-tags">
                        <span class="tag tag-trading">TRADING ✓</span>
                        <span class="tag tag-bargaining" style="opacity: 0.5">Not Bargaining</span>
                    </div>
                </div>
                <div class="test-body">
                    <div class="test-input">"It's just paper—5 suppliers. But we bundled managed services, 3-year volume, sustainability reporting."</div>
                    <p><strong>Rule Applied:</strong> Complexity Overrides Attention</p>
                </div>
            </div>

            <div class="test-case">
                <div class="test-header">
                    <h4>Case 3: Excellent New Relationship</h4>
                    <div class="test-tags">
                        <span class="tag tag-trading">TRADING ✓</span>
                        <span class="tag tag-creating" style="opacity: 0.5">Not Creating</span>
                    </div>
                </div>
                <div class="test-body">
                    <div class="test-input">"Absolutely exceptional vendor, 18 months, exceeded every KPI, discussing joint cost reduction."</div>
                    <p><strong>Rule Applied:</strong> Tenure Threshold Is Hard (18mo &lt; 2yr)</p>
                </div>
            </div>

            <div class="test-case">
                <div class="test-header">
                    <h4>Case 4: Dormant Partnership</h4>
                    <div class="test-tags">
                        <span class="tag tag-trading">TRADING ✓</span>
                        <span class="tag tag-partnering" style="opacity: 0.5">Not Partnering</span>
                    </div>
                </div>
                <div class="test-body">
                    <div class="test-input">"7 years, used to do joint planning, but last 2 years transactional. Now they're aggressive."</div>
                    <p><strong>Rule Applied:</strong> Current Behavior Overrides History</p>
                </div>
            </div>

            <div class="test-case">
                <div class="test-header">
                    <h4>Case 5: Single Source by Choice</h4>
                    <div class="test-tags">
                        <span class="tag tag-creating">CREATING ✓</span>
                        <span class="tag tag-batna" style="opacity: 0.5">Not BATNA</span>
                    </div>
                </div>
                <div class="test-body">
                    <div class="test-input">"We only use this supplier. Others exist, we just never qualified them—this vendor's been perfect 4 years."</div>
                    <p><strong>Rule Applied:</strong> Choice ≠ Constraint</p>
                </div>
            </div>

            <div class="test-case">
                <div class="test-header">
                    <h4>Case 8: Emergency Commodity</h4>
                    <div class="test-tags">
                        <span class="tag tag-bargaining">BARGAINING ✓</span>
                        <span class="tag tag-batna" style="opacity: 0.5">Not BATNA</span>
                    </div>
                </div>
                <div class="test-body">
                    <div class="test-input">"Need packaging in 2 weeks. 10 suppliers make it, but only current vendor can hit timeline."</div>
                    <p><strong>Rule Applied:</strong> Temporary ≠ Structural</p>
                </div>
            </div>

            <div class="test-case">
                <div class="test-header">
                    <h4>Case 9: Collaborative Commodity</h4>
                    <div class="test-tags">
                        <span class="tag tag-bargaining">BARGAINING ✓</span>
                        <span class="tag tag-creating" style="opacity: 0.5">Not Creating</span>
                    </div>
                </div>
                <div class="test-body">
                    <div class="test-input">"Standard fasteners, 20 companies make them. But we've been with this vendor 4 years—incredibly helpful."</div>
                    <p><strong>Rule Applied:</strong> Market Structure Dominates</p>
                </div>
            </div>

            <div class="test-case">
                <div class="test-header">
                    <h4>Case 10: Regulated Lock-in</h4>
                    <div class="test-tags">
                        <span class="tag tag-trading">TRADING ✓</span>
                        <span class="tag tag-batna" style="opacity: 0.5">Not BATNA</span>
                    </div>
                </div>
                <div class="test-body">
                    <div class="test-input">"FDA-validated supplier. Two alternatives need 6-month revalidation. Contract renews in 8 months."</div>
                    <p><strong>Rule Applied:</strong> Timeline Math Overrides (6mo &lt; 8mo = viable)</p>
                </div>
            </div>
        </div>

        <!-- Implementation -->
        <div class="card">
            <h2>Implementation Files</h2>
            <table>
                <tr>
                    <th>File</th>
                    <th>Purpose</th>
                </tr>
                <tr>
                    <td><code>src/chatbot/prompts/v3-conversational-classification-prompt.ts</code></td>
                    <td>V3 system prompt with signal extraction + inference rules</td>
                </tr>
                <tr>
                    <td><code>src/chatbot/__tests__/v3-classification.test.ts</code></td>
                    <td>Test harness with 10 edge cases (26 tests, 100% pass)</td>
                </tr>
                <tr>
                    <td><code>docs/engineering/CONVERSATIONAL_CLASSIFICATION_GUIDE.md</code></td>
                    <td>Technical documentation</td>
                </tr>
            </table>
        </div>

        <!-- Next Steps -->
        <div class="card">
            <h2>Validation Next Steps</h2>
            <ol style="margin-left: 1.5rem; color: var(--muted);">
                <li style="margin-bottom: 0.5rem;">Review 8 inference rules for procurement authenticity</li>
                <li style="margin-bottom: 0.5rem;">Test V3 prompt with real user inputs</li>
                <li style="margin-bottom: 0.5rem;">Compare UX: V2 (4-round) vs V3 (conversational)</li>
                <li style="margin-bottom: 0.5rem;">Validate signal extraction accuracy with AI</li>
                <li style="margin-bottom: 0.5rem;">Sign off for V3 rollout</li>
            </ol>
        </div>
    </div>

    <footer>
        <p><strong>Ali MVP - Conversational Classification Architecture V3</strong></p>
        <p>November 24, 2025 | Terrance Chatman</p>
    </footer>
</body>
</html>
